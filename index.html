<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‡ç©ºæ¨¡æ‹Ÿå™¨</title>
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        h1 {
            margin-top: 20px;
            font-size: 1.5em;
        }
        #card-container {
            margin: 10px auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            width: 90%;
            max-width: 600px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 10px;
        }
        .card-row {
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        .card {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2em;
            border-radius: 10px;
            color: #fff;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            transition: transform 0.5s;
        }
        .gold-card {
            background-color: #FFD600;
        }
        .purple-card {
            background-color: #C466FA;
        }
        .blue-card {
            background-color: #B6E4FF;
        }
        .card.flip {
            transform: rotateY(180deg);
        }
        .bling {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1em;
            color: gold;
            animation: bling 1s infinite;
        }
        @keyframes bling {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        #result {
            margin-top: 10px;
            font-size: 1em;
        }
        button {
            padding: 10px 15px;
            font-size: 1em;
            cursor: pointer;
            margin: 5px;
        }
        .button-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .history-item.gold {
            color: #FFD600;
        }
        .history-item.purple {
            color: #C466FA;
        }
        .history-item.blue {
            color: #B6E4FF;
        }
        .page-btn {
            display: inline-block;
            margin: 2px;
            padding: 5px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
        }
        .active-page {
            background-color: #ccc;
        }
        .ellipsis {
            pointer-events: none;
            cursor: default;
        }
        #history-container, #stats-container, #pokedex-container {
            display: none;
            margin-top: 20px;
            text-align: center;
            width: 90%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        #history-list, #pokedex-list {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .pokedex-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .pokedex-item {
            width: 100px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            text-align: center;
        }
        .pokedex-item.unobtained {
            background-color: #eee;
            color: #999;
        }
        @media (max-width: 600px) {
            .card {
                width: 50px;
                height: 50px;
                font-size: 1em;
            }
            button {
                padding: 8px 12px;
                font-size: 0.9em;
            }
            #result {
                font-size: 0.9em;
            }
            .button-container {
                flex-direction: column;
                gap: 5px;
            }

            .pokedex-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 10px;
                margin: 5px;
                width: 120px; 
                border: 1px solid #ccc;
                border-radius: 8px;
                background-color: #f9f9f9;
            }

            .pokedex-item-name {
                font-weight: bold;
                font-size: 16px;
                margin-bottom: 5px;
                text-align: center;
            }

            .pokedex-item-count {
                font-size: 14px;
                color: #666;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <h1>å‡ç©ºæ¨¡æ‹Ÿå™¨</h1>
    <div id="card-container">
        <!-- å¡ç‰‡æ˜¾ç¤ºåŒºåŸŸ -->
    </div>
    <div class="button-container">
        <button onclick="drawCard()">å•æ¬¡å‡ç©º</button>
        <button onclick="drawMultipleCards()">åæ¬¡å‡ç©º</button>
        <button onclick="toggleHistory()">å†å²è®°å½•</button>
        <button onclick="toggleStats()">å‡ºé‡‘ç»Ÿè®¡</button>
        <button onclick="togglePokedex()">å›¾é‰´</button>
    </div>
    <div id="result"></div>

    <div id="history-container">
        <h2>å†å²è®°å½•</h2>
        <div id="history-list"></div>
        <div id="pagination"></div>
    </div>

    <div id="stats-container">
        <h2>å‡ºé‡‘ç»Ÿè®¡</h2>
        <div id="stats-list"></div>
    </div>

    <div id="pokedex-container">
        <h2>å›¾é‰´</h2>
        <div id="pokedex-list"></div>
    </div>

    <script>
        const cards = [
            { name: 'é‡‘', baseProbability: 0.01 },
            { name: 'ç´«', baseProbability: 0.07 },
            { name: 'è“', baseProbability: 0.92 }
        ];

        const goldCards = [
            'æ˜Ÿæ˜Ÿç‹å­(ä¸Š)', 'æ˜Ÿæ˜Ÿç‹å­(ä¸‹)','æµå…‰å…”å…”','æ¯›ç»’å…”å…”','æ¨±èŠ±å…”å…”',
            'å…ˆçŸ¥æ¢¨(ä¸Š)','å…ˆçŸ¥æ¢¨(ä¸‹)','çœ¼é•œæ¢¨','å¤±åºæ¢¨','ç¡è¡£æ¢¨',
            'é‡‘æ²™é±¼(ä¸Š)','é‡‘æ²™é±¼(ä¸‹)','é—»é¦™å°é±¼','è…¹è‚Œå°é±¼','æ¨±èŠ±å°é±¼',
            'æ‹³å‡»é¸¦(ä¸Š)','æ‹³å‡»é¸¦(ä¸‹)','é¸¦ã®è¡£æŸœPlay','å¥¶109é¸¦','ä¸‹é›ªäº†é¸¦'
        ];

        let historyData = [];
        let goldStats = [];
        let drawCount = 0;
        let noGoldCount = 0;
        let pokedex = {};

        goldCards.forEach(card => {
            pokedex[card] = 0;
        });

        function getDrawResult() {
            drawCount++;
            noGoldCount++;
            let result;

            if (drawCount % 10 === 0) {
                result = 'ç´«';
            } else if (noGoldCount >= 70) {
                result = getRandomGoldCard();
                recordGoldDraw(result);
            } else if (noGoldCount >= 60) {
                result = getRandomCard(0.01 + 0.1 * (noGoldCount - 60));
            } else {
                result = getRandomCard(0.01);
            }

            if (goldCards.includes(result)) {
                recordGoldDraw(result);
            }

            return result;
        }

        function drawCard() {
            const result = getDrawResult();
            if (goldCards.includes(result)) {
                showGoldCard(result);
            } else {
                showSingleCard(result);
            }
            addToHistory([result]);
        }

        function drawMultipleCards() {
            const results = [];
            for (let i = 0; i < 10; i++) {
                results.push(getDrawResult());
            }
            showMultipleCards(results);
            addToHistory(results);
        }

        function getRandomGoldCard() {
            const randomIndex = Math.floor(Math.random() * goldCards.length);
            return goldCards[randomIndex];
        }

        function getRandomCard(baseProbability) {
            const goldProbability = baseProbability;
            const purpleProbability = 0.07;
            const randomNum = Math.random();
            if (randomNum < goldProbability) {
                return getRandomGoldCard();
            } else if (randomNum < goldProbability + purpleProbability) {
                return 'ç´«';
            } else {
                return 'è“';
            }
        }

        function showSingleCard(result) {
            const cardContainer = document.getElementById('card-container');
            cardContainer.innerHTML = '';

            const cardElement = document.createElement('div');
            cardElement.className = 'card';
            if (goldCards.includes(result)) {
                cardElement.classList.add('gold-card');
            } else if (result === 'ç´«') {
                cardElement.classList.add('purple-card');
            } else if (result === 'è“') {
                cardElement.classList.add('blue-card');
            }
            cardElement.innerText = result;
            cardContainer.appendChild(cardElement);
        }

        function showMultipleCards(results) {
            const cardContainer = document.getElementById('card-container');
            cardContainer.innerHTML = '';

            const topRow = document.createElement('div');
            topRow.className = 'card-row';
            const bottomRow = document.createElement('div');
            bottomRow.className = 'card-row';

            const createCardElement = (result) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';

                let displayText = '';
                if (goldCards.includes(result)) {
                    cardElement.classList.add('gold-card');
                    displayText = 'é‡‘'; // åˆå§‹æ˜¾ç¤ºâ€œé‡‘â€å­—

                    setTimeout(() => {
                        cardElement.classList.add('shake'); // å¢åŠ éœ‡åŠ¨æ•ˆæœ
                        setTimeout(() => {
                            cardElement.classList.remove('shake');
                            cardElement.classList.add('flip'); // å¢åŠ ç¿»è½¬æ•ˆæœ
                            setTimeout(() => {
                                cardElement.classList.remove('flip');
                                if (result.includes('æ˜Ÿ') || result.includes('å…”')) {
                                    displayText = 'ğŸ°';
                                } else if (result.includes('æ¢¨')) {
                                    displayText = 'ğŸ';
                                } else if (result.includes('é±¼')) {
                                    displayText = 'ğŸŸ';
                                } else if (result.includes('é¸¦')) {
                                    displayText = 'ğŸ¦';
                                }
                                cardElement.innerText = displayText;
                            }, 1000);
                        }, 500);
                    }, 500);
                } else if (result === 'ç´«') {
                    cardElement.classList.add('purple-card');
                    displayText = 'ç´«';
                } else if (result === 'è“') {
                    cardElement.classList.add('blue-card');
                    displayText = 'è“';
                }

                cardElement.innerText = displayText;

                return cardElement;
            };

            for (let i = 0; i < results.length; i++) {
                const cardElement = createCardElement(results[i]);
                if (i < 5) {
                    topRow.appendChild(cardElement);
                } else {
                    bottomRow.appendChild(cardElement);
                }
            }

            cardContainer.appendChild(topRow);
            cardContainer.appendChild(bottomRow);
        }

        function showGoldCard(cardName) {
            const cardContainer = document.getElementById('card-container');
            cardContainer.innerHTML = '';

            const cardElement = document.createElement('div');
            cardElement.className = 'card gold-card';

            // å‡ºé‡‘ç‰¹æ•ˆ
            cardElement.innerText = 'é‡‘';
            cardContainer.appendChild(cardElement);
            cardElement.classList.add('shake');

            // å»¶è¿Ÿ1ç§’åï¼Œè§¦å‘ç¿»è½¬
            setTimeout(() => {
                cardElement.classList.remove('shake');
                cardElement.classList.add('flip');

                setTimeout(() => {
                    cardElement.classList.remove('flip');
                    let displayText;
                    if (cardName.includes('æ˜Ÿ') || cardName.includes('å…”')) {
                        displayText = 'â­';
                    } else if (cardName.includes('æ¢¨')) {
                        displayText = 'ğŸ';
                    } else if (cardName.includes('é±¼')) {
                        displayText = 'ğŸŸ';
                    } else if (cardName.includes('é¸¦')) {
                        displayText = 'ğŸ¦';
                    } else {
                        displayText = cardName; // é»˜è®¤æ˜¾ç¤ºå¡ç‰‡åç§°
                    }
                    cardElement.innerText = displayText;
                }, 1000);
            }, 1000);
        }
        
        const style = document.createElement('style');
        style.innerHTML = `
            .shake {
                animation: shake 0.5s;
            }
            @keyframes shake {
                0% { transform: translate(1px, 1px) rotate(0deg); }
                10% { transform: translate(-1px, -2px) rotate(-1deg); }
                20% { transform: translate(-3px, 0px) rotate(1deg); }
                30% { transform: translate(3px, 2px) rotate(0deg); }
                40% { transform: translate(1px, -1px) rotate(1deg); }
                50% { transform: translate(-1px, 2px) rotate(-1deg); }
                60% { transform: translate(-3px, 1px) rotate(0deg); }
                70% { transform: translate(3px, 1px) rotate(-1deg); }
                80% { transform: translate(-1px, -1px) rotate(1deg); }
                90% { transform: translate(1px, 2px) rotate(0deg); }
                100% { transform: translate(1px, -2px) rotate(-1deg); }
            }
        `;
        document.head.appendChild(style);

        function addToHistory(results) {
            historyData.push(...results);
            updateHistory();
        }

        function recordGoldDraw(goldCard) {
            goldStats.push(noGoldCount);
            noGoldCount = 0;
            pokedex[goldCard] += 1;
            updateStats();
            updatePokedex();
        }

        function updateHistory() {
            const historyContainer = document.getElementById('history-list');
            historyContainer.innerHTML = '';

            const itemsPerPage = 10;
            const totalPages = Math.ceil(historyData.length / itemsPerPage);
            let currentPage = 1;

            function renderPage(page) {
                historyContainer.innerHTML = '';
                const start = (page - 1) * itemsPerPage;
                const end = Math.min(start + itemsPerPage, historyData.length);

                for (let i = start; i < end; i++) {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    if (goldCards.includes(historyData[i])) {
                        historyItem.classList.add('gold');
                    } else if (historyData[i] === 'ç´«') {
                        historyItem.classList.add('purple');
                    } else if (historyData[i] === 'è“') {
                        historyItem.classList.add('blue');
                    }
                    historyItem.innerText = historyData[i];
                    historyContainer.appendChild(historyItem);
                }

                const paginationContainer = document.getElementById('pagination');
                paginationContainer.innerHTML = '';

                const createPageButton = (pageNum) => {
                    const pageButton = document.createElement('span');
                    pageButton.className = 'page-btn' + (pageNum === currentPage ? ' active-page' : '');
                    pageButton.innerText = pageNum;
                    pageButton.onclick = () => {
                        currentPage = pageNum;
                        renderPage(currentPage);
                    };
                    return pageButton;
                };

                const maxPagesToShow = 5;
                const halfWindow = Math.floor(maxPagesToShow / 2);

                let startPage = Math.max(1, currentPage - halfWindow);
                let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);

                if (endPage - startPage < maxPagesToShow - 1) {
                    startPage = Math.max(1, endPage - maxPagesToShow + 1);
                }

                if (startPage > 1) {
                    paginationContainer.appendChild(createPageButton(1));
                    if (startPage > 2) {
                        const ellipsis = document.createElement('span');
                        ellipsis.innerText = '...';
                        ellipsis.className = 'ellipsis';
                        paginationContainer.appendChild(ellipsis);
                    }
                }

                for (let i = startPage; i <= endPage; i++) {
                    paginationContainer.appendChild(createPageButton(i));
                }

                if (endPage < totalPages) {
                    if (endPage < totalPages - 1) {
                        const ellipsis = document.createElement('span');
                        ellipsis.innerText = '...';
                        ellipsis.className = 'ellipsis';
                        paginationContainer.appendChild(ellipsis);
                    }
                    paginationContainer.appendChild(createPageButton(totalPages));
                }
            }

            renderPage(currentPage);
        }

        function updateStats() {
            const statsContainer = document.getElementById('stats-list');
            statsContainer.innerHTML = '';

            const totalGolds = goldStats.length;
            const averageDraws = totalGolds > 0 ? (goldStats.reduce((sum, value) => sum + value, 0) / totalGolds).toFixed(2) : 0;

            statsContainer.innerHTML = `
                <p>æ€»æŠ½æ•°: ${drawCount}</p>
                <p>æ€»å‡ºé‡‘æ¬¡æ•°: ${totalGolds}</p>
                <p>å¹³å‡å‡ºé‡‘æ¬¡æ•°: ${averageDraws}</p>
                <p>æ¯æ¬¡å‡ºé‡‘æŠ½æ•°: ${goldStats.join(', ')}</p>
            `;
        }
        
        function updatePokedex() {
            const pokedexContainer = document.getElementById('pokedex-list');
            pokedexContainer.innerHTML = '';

            const screenWidth = window.innerWidth;
            let cardsPerRow;

            if (screenWidth < 400) {
                cardsPerRow = 1;
            } else if (screenWidth < 600) {
                cardsPerRow = 2;
            } else {
                cardsPerRow = 4; // é»˜è®¤æ¯è¡Œ4å¼ å¡ç‰‡
            }

            let rowElement;

            for (let i = 0; i < goldCards.length; i++) {
                if (i % cardsPerRow === 0) {
                    rowElement = document.createElement('div');
                    rowElement.className = 'pokedex-row';
                    pokedexContainer.appendChild(rowElement);
                }

                const card = goldCards[i];
                const pokedexItem = document.createElement('div');
                pokedexItem.className = 'pokedex-item' + (pokedex[card] > 0 ? '' : ' unobtained');
                
                const nameElement = document.createElement('div');
                nameElement.className = 'pokedex-item-name';
                nameElement.innerText = card;

                const countElement = document.createElement('div');
                countElement.className = 'pokedex-item-count';
                countElement.innerText = pokedex[card] > 0 ? `${pokedex[card]} å¼ ` : 'æœªè·å¾—';

                pokedexItem.appendChild(nameElement);
                pokedexItem.appendChild(countElement);

                rowElement.appendChild(pokedexItem);
            }
        }

        // è°ƒç”¨å‡½æ•°ä»¥åˆå§‹åŒ–
        updatePokedex();

        // ç›‘å¬çª—å£å¤§å°å˜åŒ–ä»¥è°ƒæ•´å¸ƒå±€
        window.addEventListener('resize', updatePokedex);

        function toggleHistory() {
            const historyContainer = document.getElementById('history-container');
            historyContainer.style.display = historyContainer.style.display === 'block' ? 'none' : 'block';
        }

        function toggleStats() {
            const statsContainer = document.getElementById('stats-container');
            statsContainer.style.display = statsContainer.style.display === 'block' ? 'none' : 'block';
        }

        function togglePokedex() {
            const pokedexContainer = document.getElementById('pokedex-container');
            pokedexContainer.style.display = pokedexContainer.style.display === 'block' ? 'none' : 'block';
        }
    </script>
</body>
</html>
